{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Literature Triage Agent I/O Schema",
  "description": "JSON schema for agent-lit-triage input and output structures",
  "version": "1.0.0",
  "definitions": {
    "TriageInput": {
      "type": "object",
      "required": ["request_id", "task_type", "inputs"],
      "properties": {
        "request_id": {
          "type": "string",
          "minLength": 1,
          "description": "Unique identifier for this triage request",
          "example": "req-123-456"
        },
        "task_type": {
          "type": "string",
          "const": "LIT_TRIAGE",
          "description": "Must be LIT_TRIAGE for this agent"
        },
        "mode": {
          "type": "string",
          "enum": ["DEMO", "LIVE"],
          "default": "DEMO",
          "description": "Execution mode (DEMO or LIVE)"
        },
        "risk_tier": {
          "type": "string",
          "enum": ["PHI", "SENSITIVE", "NON_SENSITIVE"],
          "description": "Risk classification for the request"
        },
        "domain_id": {
          "type": "string",
          "description": "Optional domain identifier"
        },
        "inputs": {
          "$ref": "#/definitions/TriageInputs"
        },
        "budgets": {
          "type": "object",
          "description": "Optional budget constraints"
        }
      }
    },
    "TriageInputs": {
      "type": "object",
      "required": ["query"],
      "properties": {
        "query": {
          "type": "string",
          "minLength": 1,
          "description": "Research question or topic for literature triage",
          "example": "CAR-T cell therapy efficacy in relapsed/refractory B-cell lymphoma"
        },
        "date_range_days": {
          "type": "integer",
          "minimum": 1,
          "maximum": 3650,
          "default": 730,
          "description": "Search papers from last N days (default: 730 = 2 years)"
        },
        "min_results": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 15,
          "description": "Minimum number of papers to retrieve and rank"
        },
        "use_ai": {
          "type": "boolean",
          "default": true,
          "description": "Use AI-powered triage (true) or legacy rule-based (false)"
        }
      }
    },
    "TriageOutput": {
      "type": "object",
      "required": ["ok", "request_id", "task_type", "outputs"],
      "properties": {
        "ok": {
          "type": "boolean",
          "description": "Success indicator"
        },
        "request_id": {
          "type": "string",
          "description": "Request identifier (echoed from input)"
        },
        "task_type": {
          "type": "string",
          "const": "LIT_TRIAGE"
        },
        "outputs": {
          "$ref": "#/definitions/TriageOutputs"
        },
        "warnings": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Non-fatal warnings from execution"
        }
      }
    },
    "TriageOutputs": {
      "type": "object",
      "required": ["query", "papers", "stats"],
      "properties": {
        "query": {
          "type": "string",
          "description": "Original query (echoed)"
        },
        "executive_summary": {
          "type": "string",
          "description": "AI-generated executive summary of triage results"
        },
        "papers": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/RankedPaper"
          },
          "description": "Ranked list of papers (Tier 1, then Tier 2, then Tier 3)"
        },
        "tier1_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of Must Read papers (score â‰¥ 75)"
        },
        "tier2_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of Should Read papers (score 50-74)"
        },
        "tier3_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of Optional papers (score < 50)"
        },
        "stats": {
          "type": "object",
          "required": ["found", "ranked"],
          "properties": {
            "found": {
              "type": "integer",
              "description": "Total papers found by search"
            },
            "ranked": {
              "type": "integer",
              "description": "Total papers ranked"
            }
          }
        },
        "markdown_report": {
          "type": "string",
          "description": "Full markdown-formatted triage report"
        }
      }
    },
    "RankedPaper": {
      "type": "object",
      "required": ["title", "score", "tier"],
      "properties": {
        "title": {
          "type": "string",
          "description": "Paper title"
        },
        "abstract": {
          "type": "string",
          "description": "Paper abstract"
        },
        "authors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of author names"
        },
        "year": {
          "type": "integer",
          "minimum": 1900,
          "maximum": 2100,
          "description": "Publication year"
        },
        "journal": {
          "type": "string",
          "description": "Journal or venue name"
        },
        "doi": {
          "type": "string",
          "description": "Digital Object Identifier"
        },
        "pmid": {
          "type": "string",
          "description": "PubMed ID"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "URL to paper"
        },
        "source": {
          "type": "string",
          "description": "Data source (e.g., 'Exa', 'PubMed')"
        },
        "score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Composite triage score (0-100)"
        },
        "tier": {
          "type": "string",
          "enum": ["tier1", "tier2", "tier3"],
          "description": "Priority tier (tier1=Must Read, tier2=Should Read, tier3=Optional)"
        },
        "scoring_breakdown": {
          "type": "object",
          "description": "Detailed scoring components",
          "properties": {
            "recency_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "relevance_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "journal_impact_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "author_reputation_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            },
            "citation_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 10
            }
          }
        },
        "rationale": {
          "type": "string",
          "description": "Brief explanation of tier assignment"
        }
      }
    }
  },
  "oneOf": [
    {
      "title": "Input Schema",
      "$ref": "#/definitions/TriageInput"
    },
    {
      "title": "Output Schema",
      "$ref": "#/definitions/TriageOutput"
    }
  ],
  "examples": [
    {
      "title": "Example Input",
      "value": {
        "request_id": "req-001",
        "task_type": "LIT_TRIAGE",
        "mode": "DEMO",
        "inputs": {
          "query": "CAR-T therapy efficacy in lymphoma",
          "date_range_days": 730,
          "min_results": 15
        }
      }
    },
    {
      "title": "Example Output",
      "value": {
        "ok": true,
        "request_id": "req-001",
        "task_type": "LIT_TRIAGE",
        "outputs": {
          "query": "CAR-T therapy efficacy in lymphoma",
          "executive_summary": "This literature triage identified 23 relevant papers addressing CAR-T cell therapy efficacy in lymphoma. Of these, 6 papers were classified as 'Must Read' based on their high relevance, recency, and impact.",
          "papers": [
            {
              "title": "Axicabtagene ciloleucel in relapsed or refractory large B-cell lymphoma",
              "abstract": "CAR-T therapy showed 82% ORR...",
              "authors": ["Neelapu SS", "Locke FL"],
              "year": 2023,
              "journal": "New England Journal of Medicine",
              "doi": "10.1056/NEJMoa2345678",
              "pmid": "37123456",
              "url": "https://www.nejm.org/doi/full/10.1056/NEJMoa2345678",
              "source": "PubMed",
              "score": 92.5,
              "tier": "tier1",
              "scoring_breakdown": {
                "recency_score": 10,
                "relevance_score": 9.5,
                "journal_impact_score": 10,
                "author_reputation_score": 9,
                "citation_score": 8
              },
              "rationale": "Recent high-impact study in NEJM with strong methodology and outcomes"
            }
          ],
          "tier1_count": 6,
          "tier2_count": 11,
          "tier3_count": 6,
          "stats": {
            "found": 23,
            "ranked": 23
          },
          "markdown_report": "# ðŸ“‹ Literature Triage Report\n\n**Query**: CAR-T therapy efficacy in lymphoma\n..."
        },
        "warnings": []
      }
    }
  ]
}
